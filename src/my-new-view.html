<link rel="import" href="../bower_components/polymer/polymer.html" />
<link rel="import" href="../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../bower_components/px-data-table/px-data-table.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="my-form.html">


<dom-module id="my-new-view">
  <link rel="import" type="css" href="styles.css">
  <!-- Defines the element's style and local DOM -->
  <template>
    <style>
      :host {
        display: block;

        padding: 16px;
      }
    </style>
    <template id="new1">
      <p>Success</p>
    </template>
    <h1>New view</h1>
    <paper-slider min="-100" max="100" value="50"></paper-slider>
    <px-data-table filterable table-data="[[data]]">
      <px-data-table-column sortable filterable name="name" label="Name" type="html"></px-data-table-column>
      <px-data-table-column sortable filterable name="resource" label="Resource"></px-data-table-column>
      <px-data-table-column sortable filterable name="date" label="Due Date"></px-data-table-column>
      <px-data-table-column sortable filterable name="checkout" label="Checkout" type="html"></px-data-table-column>
    </px-data-table>
    <iron-ajax url="data.json" on-response="handleResponse" auto></iron-ajax>

    <form>
      <fieldset class="form-field">
        <legend>Basic form</legend>
        <ol class="list-bare">
          <li class="form-field">
            <label for="input1">Name</label>
            <input id="input1" class="text-input" type="text" placeholder="First name">
            <small class="form-field__help">Enter your name here</small>
          </li>
          <li class="form-field">
            <input id="chk1" type="checkbox">
            <label class="label--inline" for="chk1">No Lastname</label>
          </li>
        </ol>
        <input class="btn btn--primary" type="submit" value="Submit">
        <input class="btn" type="reset" value="Cancel">
      </fieldset>
    </form>

  </template>
  <!-- Creates the element's prototype and registers it -->
  <script>
    Polymer({
      is: 'my-new-view',
      properties: {
        data: {
          type: Array,
          value: []
        },
        temp: {
          type: String,
          value: 'World'
        }
      },
      ready: function() {
        var self = this;
        var proto = Object.create(HTMLElement.prototype, {
          createdCallback: {
            value: function() {
              var t = self.$$('#new1');
              var clone = document.importNode(t.content, true);
              this.createShadowRoot().appendChild(clone);
            }
          }
        });
        document.registerElement("hello-there", {prototype: proto});
      },
      handleResponse: function(response) {
        var result = response.detail.response;
        var list = [];
        this.$.new1;
        for(var i=0;i<result.length;i++) {
          var item = {};
          item.id = result[i].id;
          item.name = this._getNameElement();
          item.resource = result[i].resource;
          var element = this.getResourceElement(item.id);
          item.checkout = element;
          item.date = new Date().toLocaleDateString();
          list.push(item);
        }
        this.data = list;
      },
      getResourceElement: function(id) {
        return '<my-form test-equipment-id="' + id + '"></my-form>'; 
      },
      _getNameElement() {
        return '<hello-there></hello-there>';
      }
    });
  </script>
</dom-module>
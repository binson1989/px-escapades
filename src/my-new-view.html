<link rel="import" href="../bower_components/polymer/polymer.html" />
<link rel="import" href="../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../bower_components/px-data-table/px-data-table.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="my-form.html">
<link rel="import" href="../bower_components/px-app-nav/px-app-nav.html">
<link rel="import" href="../bower_components/px-theme/px-theme.html">
<link rel="import" href="../bower_components/px-dropdown/px-dropdown.html">
<link rel="import" href="../bower_components/px-context-browser/px-context-browser.html"/>
<link rel="import" href="../bower_components/px-theme/px-app-styles.html">

<dom-module id="my-new-view">
  <link rel="import" type="css" href="styles.css">
  <!-- Defines the element's style and local DOM -->
  <template>
    <style include="px-app-styles"></style>
    <style>
      :host {
        display: block;

        padding: 16px;
      }
      .flex, .inline--flex{
        border: solid 4px #000;
      }
      .flex___item {
        flex:1;
        border: solid 2px #000;
      }
    </style>
    <template id="new1">
      <p>Success</p>
    </template>
    <h1>New view</h1>
    <paper-slider min="-100" max="100" value="50"></paper-slider>
    <px-data-table filterable table-data="[[data]]">
      <px-data-table-column sortable filterable name="name" label="Name" type="html"></px-data-table-column>
      <px-data-table-column sortable filterable name="resource" label="Resource"></px-data-table-column>
      <px-data-table-column sortable filterable name="date" label="Due Date"></px-data-table-column>
      <px-data-table-column sortable filterable name="checkout" label="Checkout" type="html"></px-data-table-column>
    </px-data-table>
    <iron-ajax url="data.json" on-response="handleResponse" auto></iron-ajax>

    <form>
      <fieldset class="form-field">
        <legend>Basic form</legend>
        <div class="flex flex--row flex--wrap flex--justify form-field u-mt">
          <div class="flex___item">
            <input class="text-input input--regular" type="text" placeholder="Hello 1">
          </div>
          <div class="flex___item">
            <input class="text-input input--regular" type="text" placeholder="Hello 2">
          </div>
            <!--<div class="inline--flex flex--col flex___item">
              <label for="abc">Field 1</label>
              <input id="abc" class="text-input input--regular flex___item" type="text" placeholder="New field 1" required>
            </div>
            <div class="inline--flex flex--col flex___item">
              <label for="def">Field 2</label>
              <input id="def" class="text-input input--regular flex___item" type="text" placeholder="New field 2" required>
            </div>-->
        </div>
        <!--<div class="flex flex--row flex--wrap flex--justify">
          <div class="flex___item flex flex--col">
            <label for="input11">Name</label>
            <input id="input11" class="text-input input--regular" type="text" placeholder="First name" required>
          </div>
          <div class="flex___item">
            <label for="input12">Address 1</label>
            <input id="input12" class="text-input input--regular" type="text" placeholder="Address" required>
          </div>
          <div class="flex__item">
            <label for="input13">Address 2</label>
            <input id="input13" class="text-input input--regular" type="text" placeholder="Address" required>
          </div>
        </div>
        
        <ol class="list-bare flex flex--row flex--wrap flex--justify">
          <li class="flex___item form-field flex flex--col">
            <label for="input1">Name</label>
            <input id="input1" class="text-input input--regular" type="text" placeholder="First name" required>
          </li>
          <li class="flex___item form-field flex flex--col">
            <label for="input2">Address</label>
            <input id="input2" class="text-input input--regular" type="text" placeholder="Address" required>
          </li>
          <li class="flex___item form-field flex flex--col">
            <label for="input3">Landmark</label>
            <input id="input3" class="text-input input--regular" type="text" placeholder="Landmark" required>
          </li>
          <li class="flex___item form-field flex flex--col">
            <input id="chk1" type="checkbox" required>
            <label class="label--inline" for="chk1">No Lastname</label>
          </li>
          <li class="flex___item form-field flex flex--col">
            <px-dropdown display-value="Elephant">
              <px-dropdown-content extend-dropdown='true' 
              extend-dropdown-by='25' 
              max-cont-character-width='10' 
              items='[{"key":"one","val":"Iphone"},{"key":"two","val":"Android"},{"key":"three","val":"Blackberry"},{"key":"four","val":"Windows Phone"}]'>
              </px-dropdown-content>
            </px-dropdown>
          </li>
        </ol>-->
        <!--<input class="btn btn--primary" type="submit" value="Submit">
        <input class="btn" type="reset" value="Cancel">-->
      </fieldset>
    </form>

    <div class="flex flex--col">
                  <div class="demo u-p+">
                    <div style="height:350px;">
                      <px-app-nav style="position:inherit" nav-items="[[items]]">
                      </px-app-nav>
                    </div>
                  </div>
    </div>

    <template is="dom-repeat" items={{optionsArray}}>
    <div class="flex flex--col">
                <div class="demo u-p+">

                  <px-context-browser
                    label-field="[[item.labelField]]"
                    id-field="[[item.idField]]"
                    browser-context="[[getData(index)]]"
                    show-chevron="[[item.showChevron]]"
                    show-column-browser="[[item.showColumnBrowser]]"
                    opened-item-name="[[item.openedItemName]]"
                    ></px-context-browser>
                  </div>
                </div>
    </template>
  </template>
  <!-- Creates the element's prototype and registers it -->
  <script>
    Polymer({
      is: 'my-new-view',
      properties: {
        data: {
          type: Array,
          value: []
        },
        temp: {
          type: String,
          value: 'World'
        },
        items: {
          type: Array,
          value: [
            {"path":"tab1","icon":"fa-exclamation-triangle","eventName":"firstItem","label":"Alerts","subitems":[{"label":"Sub Category 1","href":null,"class":"","subitemclass":"","subitemlistclass":"","selected":false},{"label":"Sub Category 2","eventName":"subitemTwo","href":null,"class":"","subitemclass":"","subitemlistclass":"","selected":false},{"label":"Sub Category 3","path":"subitem3","href":"#subitem3","class":"","subitemclass":"","subitemlistclass":"","selected":false}],"href":"#tab1","class":"","subitemclass":"visuallyhidden","subitemlistclass":"visuallyhidden list-bare","selected":false,"subSelected":false},{"path":"tab2","icon":"fa-briefcase","label":"Cases","subitems":[{"label":"Sub Category 1","href":null,"class":"","subitemclass":"","subitemlistclass":"","selected":false},{"label":"Sub Category 2","href":null,"class":"","subitemclass":"","subitemlistclass":"","selected":false},{"label":"Sub Category 3","href":null,"class":"","subitemclass":"","subitemlistclass":"","selected":false}],"href":"#tab2","class":"","subitemclass":"visuallyhidden","subitemlistclass":"visuallyhidden list-bare","selected":false,"subSelected":false},{"path":"tab3","icon":"fa-bar-chart","label":"Analysis","href":"#tab3","class":"","subitemclass":"visuallyhidden","subitemlistclass":"visuallyhidden list-bare","selected":false,"subSelected":false},{"path":"tab4","icon":"fa-tachometer","label":"Dashboards","href":"#tab4","class":"","subitemclass":"visuallyhidden","subitemlistclass":"visuallyhidden list-bare","selected":false,"subSelected":false}
          ]
        },
        optionsArray: {
          type: Array,
          value: [
        {
          labelField:"name",
          idField:"identifier",
          showChevron:true,
          openedItemName: "Select Context",
          showColumnBrowser: false
        },
        {
          labelField:"name",
          idField:"identifier",
          showChevron:true,
          openedItemName: "Select Context",
          showColumnBrowser: false
        }
      ]
        },
        browserContextArray: {
          type: Array,
          value: [{
        "data": [
            {
                "identifier": "001-1",
                "name": "Lots of Children",
                "isOpenable" : true,
                "hasChildren": true
            },
            {
              "identifier": "001-2",
              "name": "Deep nested",
              "isOpenable" : true,
              "children": [
                    {
                        "identifier": "001-2a",
                        "name": "Nested Child 1",
                        "isOpenable" : true,
                        "children": [
                          {
                            "identifier": "001-2aa",
                            "name": "Nested Grandchild 1",
                            "isOpenable" : true,
                            "children" : [{
                              "identifier": "001-2aba",
                              "name": "Nested Great Grandchild 1",
                              "isOpenable" : true
                            },
                            {
                              "identifier": "001-2abb",
                              "name": "Nested Great Grandchild 2",
                              "isOpenable" : true
                            },
                            {
                              "identifier": "001-2abc",
                              "name": "Nested_Great_Grandchild_3333333333333333333333333333333",
                              "isOpenable" : true,
                              "selectedAsset": true
                            }],
                            "meta": { "parentId": "001-2ab" }
                          },
                          {
                            "identifier": "001-2ab",
                            "name": "Nested Grandchild 2",
                            "isOpenable" : true
                          },
                          {
                            "identifier": "001-2ac",
                            "name": "Nested Grandchild 3",
                            "isOpenable" : true
                          }
                        ],
                        "meta": { "parentId": "001-2a" }
                    },
                    {
                      "identifier": "001-2b",
                      "name": "Nested Child 2",
                      "isOpenable" : true
                    },
                    {
                      "identifier": "001-2c",
                      "name": "Nested Child 3",
                      "isOpenable" : true
                    }
                ],
                "meta": { "parentId": "001-2" }
            },
            {
            "identifier": "001-3",
            "name": "Nothing Below Me",
            "isOpenable" : true
            },
            {
            "identifier": "001-4",
            "name": "Nothing Below, Not openable"
           }
        ],
        "meta": { "parentId": null }
        }, {
          "data": [
            {
              "name": "Lots of children",
              "identifier": "001-1",
              "isOpenable": true,
              "hasChildren": true
            }, {
              "name": "Deep nested",
              "identifier": "001-2",
              "isOpenable": true,
              "hasChildren": true
            }, {
              "name": "Nothing Below Me",
              "identifier": "001-3",
              "isOpenable": true
            }, {
              "name": "Nothing Below, Not openable",
              "identifier": "001-4",
              "isOpenable": false
            }
          ],
          "meta": {
            "parentId": null
          }
        }
      ]
        }
      },
      ready: function() {
        var self = this;
        var proto = Object.create(HTMLElement.prototype, {
          createdCallback: {
            value: function() {
              var t = self.$$('#new1');
              var clone = document.importNode(t.content, true);
              this.createShadowRoot().appendChild(clone);
            }
          }
        });
        document.registerElement("hello-there", {prototype: proto});
      },
      handleResponse: function(response) {
        var result = response.detail.response;
        var list = [];
        this.$.new1;
        for(var i=0;i<result.length;i++) {
          var item = {};
          item.id = result[i].id;
          item.name = this._getNameElement();
          item.resource = result[i].resource;
          var element = this.getResourceElement(item.id);
          item.checkout = element;
          item.date = new Date().toLocaleDateString();
          list.push(item);
        }
        this.data = list;
      },
      getResourceElement: function(id) {
        return '<my-form test-equipment-id="' + id + '"></my-form>'; 
      },
      _getNameElement() {
        return '<hello-there></hello-there>';
      },
      getData: function(index) {
        return this.browserContextArray[index];
      }
    });
  </script>
</dom-module>